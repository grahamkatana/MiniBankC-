apiVersion: batch/v1
kind: Job
metadata:
  name: minibank-migration
  namespace: minibank
spec:
  template:
    spec:
      containers:
      - name: migration
        image: grahamkatana/minibank-api:latest  # ‚Üê Your Docker username
        command: ["/bin/sh", "-c"]
        args:
        - |
          dotnet ef database update --no-build
        env:
        - name: ConnectionStrings__DefaultConnection
          valueFrom:
            secretKeyRef:
              name: minibank-secrets
              key: CONNECTION_STRING
      restartPolicy: OnFailure
  backoffLimit: 3